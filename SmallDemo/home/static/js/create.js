const listProgram = ["A# .NET", "A# (Axiom)", "A-0 System", "A+", "A++", "ABAP", "ABC", "ABC ALGOL", "ABLE", "ABSET", "ABSYS", "ACC", "Accent", "Ace DASL", "ACL2", "ACT-III", "Action!", "ActionScript", "Ada", "Adenine", "Agda", "Agilent VEE", "Agora", "AIMMS", "Alef", "ALF", "ALGOL 58", "ALGOL 60", "ALGOL 68", "ALGOL W", "Alice", "Alma-0", "AmbientTalk", "Amiga E", "AMOS", "AMPL", "APL", "App Inventor for Android's visual block language", "AppleScript", "Arc", "ARexx", "Argus", "AspectJ", "Assembly language", "ATS", "Ateji PX", "AutoHotkey", "Autocoder", "AutoIt", "AutoLISP / Visual LISP", "Averest", "AWK", "Axum", "B", "Babbage", "Bash", "BASIC", "bc", "BCPL", "BeanShell", "Batch (Windows/Dos)", "Bertrand", "BETA", "Bigwig", "Bistro", "BitC", "BLISS", "Blue", "Bon", "Boo", "Boomerang", "Bourne shell", "bash", "ksh", "BREW", "BPEL", "C", "C--", "C++", "C#", "C/AL", "Caché ObjectScript", "C Shell", "Caml", "Candle", "Cayenne", "CDuce", "Cecil", "Cel", "Cesil", "Ceylon", "CFEngine", "CFML", "Cg", "Ch", "Chapel", "CHAIN", "Charity", "Charm", "Chef", "CHILL", "CHIP-8", "chomski", "ChucK", "CICS", "Cilk", "CL", "Claire", "Clarion", "Clean", "Clipper", "CLIST", "Clojure", "CLU", "CMS-2", "COBOL", "Cobra", "CODE", "CoffeeScript", "Cola", "ColdC", "ColdFusion", "COMAL", "Combined Programming Language", "COMIT", "Common Intermediate Language", "Common Lisp", "COMPASS", "Component Pascal", "Constraint Handling Rules", "Converge", "Cool", "Coq", "Coral 66", "Corn", "CorVision", "COWSEL", "CPL", "csh", "CSP", "Csound", "CUDA", "Curl", "Curry", "Cyclone", "Cython", "D", "DASL", "DASL", "Dart", "DataFlex", "Datalog", "DATATRIEVE", "dBase", "dc", "DCL", "Deesel", "Delphi", "DinkC", "DIBOL", "Dog", "Draco", "DRAKON", "Dylan", "DYNAMO", "E", "E#", "Ease", "Easy PL/I", "Easy Programming Language", "EASYTRIEVE PLUS", "ECMAScript", "Edinburgh IMP", "EGL", "Eiffel", "ELAN", "Elixir", "Elm", "Emacs Lisp", "Emerald", "Epigram", "EPL", "Erlang", "es", "Escapade", "Escher", "ESPOL", "Esterel", "Etoys", "Euclid", "Euler", "Euphoria", "EusLisp Robot Programming Language", "CMS EXEC", "EXEC 2", "Executable UML", "F", "F#", "Factor", "Falcon", "Fancy", "Fantom", "FAUST", "Felix", "Ferite", "FFP", "Fjölnir", "FL", "Flavors", "Flex", "FLOW-MATIC", "FOCAL", "FOCUS", "FOIL", "FORMAC", "@Formula", "Forth", "Fortran", "Fortress", "FoxBase", "FoxPro", "FP", "FPr", "Franz Lisp", "Frege", "F-Script", "FSProg", "G", "Google Apps Script", "Game Maker Language", "GameMonkey Script", "GAMS", "GAP", "G-code", "Genie", "GDL", "Gibiane", "GJ", "GEORGE", "GLSL", "GNU E", "GM", "Go", "Go!", "GOAL", "Gödel", "Godiva", "GOM (Good Old Mad)", "Goo", "Gosu", "GOTRAN", "GPSS", "GraphTalk", "GRASS", "Groovy", "Hack (programming language)", "HAL/S", "Hamilton C shell", "Harbour", "Hartmann pipelines", "Haskell", "Haxe", "High Level Assembly", "HLSL", "Hop", "Hope", "Hugo", "Hume", "HyperTalk", "IBM Basic assembly language", "IBM HAScript", "IBM Informix-4GL", "IBM RPG", "ICI", "Icon", "Id", "IDL", "Idris", "IMP", "Inform", "Io", "Ioke", "IPL", "IPTSCRAE", "ISLISP", "ISPF", "ISWIM", "J", "J#", "J++", "JADE", "Jako", "JAL", "Janus", "JASS", "Java", "JavaScript", "JCL", "JEAN", "Join Java", "JOSS", "Joule", "JOVIAL", "Joy", "JScript", "JScript .NET", "JavaFX Script", "Julia", "Jython", "K", "Kaleidoscope", "Karel", "Karel++", "KEE", "Kixtart", "KIF", "Kojo", "Kotlin", "KRC", "KRL", "KUKA", "KRYPTON", "ksh", "L", "L# .NET", "LabVIEW", "Ladder", "Lagoona", "LANSA", "Lasso", "LaTeX", "Lava", "LC-3", "Leda", "Legoscript", "LIL", "LilyPond", "Limbo", "Limnor", "LINC", "Lingo", "Linoleum", "LIS", "LISA", "Lisaac", "Lisp", "Lite-C", "Lithe", "Little b", "Logo", "Logtalk", "LPC", "LSE", "LSL", "LiveCode", "LiveScript", "Lua", "Lucid", "Lustre", "LYaPAS", "Lynx", "M2001", "M4", "Machine code", "MAD", "MAD/I", "Magik", "Magma", "make", "Maple", "MAPPER", "MARK-IV", "Mary", "MASM Microsoft Assembly x86", "Mathematica", "MATLAB", "Maxima", "Macsyma", "Max", "MaxScript", "Maya (MEL)", "MDL", "Mercury", "Mesa", "Metacard", "Metafont", "MetaL", "Microcode", "MicroScript", "MIIS", "MillScript", "MIMIC", "Mirah", "Miranda", "MIVA Script", "ML", "Moby", "Model 204", "Modelica", "Modula", "Modula-2", "Modula-3", "Mohol", "MOO", "Mortran", "Mouse", "MPD", "CIL", "MSL", "MUMPS", "NASM", "NATURAL", "Napier88", "Neko", "Nemerle", "nesC", "NESL", "Net.Data", "NetLogo", "NetRexx", "NewLISP", "NEWP", "Newspeak", "NewtonScript", "NGL", "Nial", "Nice", "Nickle", "Nim", "NPL", "Not eXactly C", "Not Quite C", "NSIS", "Nu", "NWScript", "NXT-G", "o:XML", "Oak", "Oberon", "Obix", "OBJ2", "Object Lisp", "ObjectLOGO", "Object REXX", "Object Pascal", "Objective-C", "Objective-J", "Obliq", "Obol", "OCaml", "occam", "occam-π", "Octave", "OmniMark", "Onyx", "Opa", "Opal", "OpenCL", "OpenEdge ABL", "OPL", "OPS5", "OptimJ", "Orc", "ORCA/Modula-2", "Oriel", "Orwell", "Oxygene", "Oz", "P#", "ParaSail (programming language)", "PARI/GP", "Pascal", "Pawn", "PCASTL", "PCF", "PEARL", "PeopleCode", "Perl", "PDL", "PHP", "Phrogram", "Pico", "Picolisp", "Pict", "Pike", "PIKT", "PILOT", "Pipelines", "Pizza", "PL-11", "PL/0", "PL/B", "PL/C", "PL/I", "PL/M", "PL/P", "PL/SQL", "PL360", "PLANC", "Plankalkül", "Planner", "PLEX", "PLEXIL", "Plus", "POP-11", "PostScript", "PortablE", "Powerhouse", "PowerBuilder", "PowerShell", "PPL", "Processing", "Processing.js", "Prograph", "PROIV", "Prolog", "PROMAL", "Promela", "PROSE modeling language", "PROTEL", "ProvideX", "Pro*C", "Pure", "Python", "Q (equational programming language)", "Q (programming language from Kx Systems)", "Qalb", "QtScript", "QuakeC", "QPL", "R", "R++", "Racket", "RAPID", "Rapira", "Ratfiv", "Ratfor", "rc", "REBOL", "Red", "Redcode", "REFAL", "Reia", "Revolution", "rex", "REXX", "Rlab", "RobotC", "ROOP", "RPG", "RPL", "RSL", "RTL/2", "Ruby", "RuneScript", "Rust", "S", "S2", "S3", "S-Lang", "S-PLUS", "SA-C", "SabreTalk", "SAIL", "SALSA", "SAM76", "SAS", "SASL", "Sather", "Sawzall", "SBL", "Scala", "Scheme", "Scilab", "Scratch", "Script.NET", "Sed", "Seed7", "Self", "SenseTalk", "SequenceL", "SETL", "Shift Script", "SIMPOL", "SIGNAL", "SiMPLE", "SIMSCRIPT", "Simula", "Simulink", "SISAL", "SLIP", "SMALL", "Smalltalk", "Small Basic", "SML", "Snap!", "SNOBOL", "SPITBOL", "Snowball", "SOL", "Span", "SPARK", "Speedcode", "SPIN", "SP/k", "SPS", "Squeak", "Squirrel", "SR", "S/SL", "Stackless Python", "Starlogo", "Strand", "Stata", "Stateflow", "Subtext", "SuperCollider", "SuperTalk", "Swift (Apple programming language)", "Swift (parallel scripting language)", "SYMPL", "SyncCharts", "SystemVerilog", "T", "TACL", "TACPOL", "TADS", "TAL", "Tcl", "Tea", "TECO", "TELCOMP", "TeX", "TEX", "TIE", "Timber", "TMG", "Tom", "TOM", "Topspeed", "TPU", "Trac", "TTM", "T-SQL", "TTCN", "Turing", "TUTOR", "TXL", "TypeScript", "Turbo C++", "Ubercode", "UCSD Pascal", "Umple", "Unicon", "Uniface", "UNITY", "Unix shell", "UnrealScript", "Vala", "VBA", "VBScript", "Verilog", "VHDL", "Visual Basic", "Visual Basic .NET", "Visual DataFlex", "Visual DialogScript", "Visual Fortran", "Visual FoxPro", "Visual J++", "Visual J#", "Visual Objects", "Visual Prolog", "VSXu", "Vvvv", "WATFIV, WATFOR", "WebDNA", "WebQL", "Windows PowerShell", "Winbatch", "Wolfram", "Wyvern", "X++", "X#", "X10", "XBL", "XC", "XMOS architecture", "xHarbour", "XL", "Xojo", "XOTcl", "XPL", "XPL0", "XQuery", "XSB", "XSLT", "XPath", "Xtend", "Yorick", "YQL", "Z notation", "Zeno", "ZOPL", "ZPL"]

//Load Form Project

$(".createProject").click(function() {
    ajaxProjectForm()
});

function ajaxProjectForm() {
    $.ajax({
        url: "/form/create/project/",
        success: function(result) {
            $("#createForm").html(result);
            createFormButton();
            validFormProject();
            $("#id_start_date, #id_end_date").datepicker({
                dateFormat: 'yy-mm-dd'
            });

            createProjectSubmit("/form/create/project/");
        }
    });
}


// Load Form Dev
$(".createDev").click(function() {
    ajaxDevForm()

});


function ajaxDevForm() {
    $.ajax({
        url: "/form/create/dev/",
        success: function(result) {
            $("#createForm").html(result);
            $('#id_language').autocomplete({
                source: listProgram
            })
            createFormButton()
            validFormDev()
            $('#id_active').click(function() {
                document.getElementById('id_project').disabled = !this.checked;
            })
            createDevSubmit("/form/create/dev/")
        }
    });
}


// Show Form
function createFormButton(selector = "popup") {
    $(`#${selector}Form`).show();
    $(".cancel").click(function() {
        $(`#${selector}Form`).hide()
    })
}


//Submit form

function createDevSubmit(url, dev_id, messages = 'New Dev Added') {
    $('#createDevForm').submit(function(e) {
        e.preventDefault();
        var projects = devsUpdate("project")
        if (!$(this).valid()) return false;
        $(".createDevSubmit").attr("disabled", "disabled");
        var first_name = $('#id_first_name').val();
        var last_name = $('#id_last_name').val();
        var active = $('#id_active').prop('checked');
        try {
            var project = $('#id_project').val();
        } catch (error) {

        }

        var language = $('#id_language').val();
        console.log(active)
        $.ajax({
            url: url,
            type: "POST",
            data: {
                projects: projects,
                dev_id: dev_id,
                first_name: first_name,
                last_name: last_name,
                active: active,
                project: project,
                language: language,
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
            },

            cache: false,
            success: function(dataResult) {
                if (dataResult.statusCode == 200) {
                    $(".createDevSubmit").removeAttr("disabled");
                    $("#success").show();
                    $('#success').html(messages);
                    $("#popupForm").hide();

                    setTimeout(function() {
                        $("#success").hide();
                        location.reload();
                    }, 2000);

                } else {
                    $("#error").show();
                    $('#error').html('ERROR!');
                    setTimeout(function() {
                        $("#error").hide();
                    }, 2000);
                }

            }
        });

    });


}


//Submit Form Project

function createProjectSubmit(url, project_id, messages = 'New Project Added') {
    $('#createProjectForm').submit(function(e) {
        e.preventDefault();
        var devs = devsUpdate()
        if (!$(this).valid()) return false;
        $(".createProjectSubmit").attr("disabled", "disabled");
        var name = $('#id_name').val();
        var des = $('#id_des').val();
        var start_date = $('#id_start_date').val();
        var end_date = $('#id_end_date').val();
        var cost = $('#id_cost').val();
        var dev = $('#id_dev').val();

        $.ajax({
            url: url,
            type: "POST",
            data: {
                devs: devs,
                project_id: project_id,
                name: name,
                des: des,
                start_date: start_date,
                end_date: end_date,
                dev: dev,
                cost: cost,
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
            },

            cache: false,
            success: function(dataResult) {
                if (dataResult.statusCode == 200) {
                    $(".createDevSubmit").removeAttr("disabled");
                    $("#success").show();
                    $('#success').html(messages);
                    $("#popupForm").hide();
                    setTimeout(function() {
                        $("#success").hide();
                        location.reload();
                    }, 2000);

                } else {
                    $("#error").show();
                    $('#error').html('ERROR!');
                    setTimeout(function() {
                        $("#error").hide();

                    }, 2000);
                }

            }
        });


    });


}


// Valid name function
function validFormDev() {
    $(document).ready(function() {
        $.validator.addMethod("validName", function(value, element) {
            // allow any non-whitespace characters as the host part
            return this.optional(element) || /^[a-zA-Z ]{3,16}$/.test(value);
            // /^[a-zA-Z ]{3,16}$/.test(value);
        }, 'Please enter a valid name.');
        $("#createDevForm").validate({
            errorClass: 'form-dev-error',
            rules: {
                "first_name": {
                    validName: true
                },
                "last_name": {
                    validName: true
                },
            },
            messages: {
                "first_name": {
                    validName: 'Please enter a valid name.'
                },
                "password": {
                    validName: 'Please enter a valid name.'
                },
            }
        });
    })
}

// Valid project Form
function validFormProject() {
    $(document).ready(function() {
        $.validator.addMethod("isdateafter", function(value, element, params) {
            var startdatevalue = $('#id_start_date').val();
            if (!value || !startdatevalue)
                return true;

            return this.optional(element) || Date.parse(startdatevalue) <= Date.parse(value);
        });
        $.validator.addMethod('validCost', function(value) {
            return Number(value) > 0;
        }, 'Enter a positive number.');
        $("#createProjectForm").validate({

            errorClass: 'form-dev-error',
            rules: {
                "name": {
                    maxlength: 50,
                    minlength: 3
                },
                "des": {
                    maxlength: 200,
                    minlength: 5
                },
                "start_date": {
                    date: true,
                    //dateFormat: true,
                },
                "end_date": {
                    date: true,
                    isdateafter: true
                },
                "cost": {
                    validCost: true,

                },
                "dev": {
                    required: false,

                }
            },
            messages: {
                "name": {
                    maxlength: "Must be 3 to 20 characters",
                    minlength: "Must be 3 to 20 characters"
                },
                "des": {
                    maxlength: "Must be 5 to 200 characters",
                    minlength: "Must be 5 to 200 characters"
                },
                "start_date": {
                    date: "Enter a valid Date",

                },
                "end_date": {
                    date: "Enter a valid Date",
                    isdateafter: "Enter a valid End Date"

                },
                "cost": {
                    validCost: "Enter a positive value",

                },
                "dev": {
                    required: "Select a project",
                },
            }
        });
    })
}

//Update project when click name or update

$('#tableproject tr td:nth-child(3) a, #tableproject tr td button:nth-child(1)').click(function(e) {
    e.preventDefault();
    var rowValue = [];
    let row = $(this).closest("tr");
    let tdLength = $(this).closest("tr").children("td").length;
    for (let i = 0; i < tdLength - 1; i++) {
        rowValue.push(row.find(`td:eq(${i})`).text());
    }
    var project_id = rowValue[1];
    $.ajax({
        url: "/form/update/project/",
        data: {
            project_id: project_id,
            csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()

        },
        success: function(result) {
            $("#createForm").html(result);
            autocompleteUpdate()
            devDetail()
            createFormButton();
            validFormProject();

            $("#id_start_date, #id_end_date").datepicker({
                dateFormat: 'yy-mm-dd'
            });
            createProjectSubmit("/form/update/project/", project_id, 'Updated');
        }
    });
});


// Load dev detail in project
function devDetail() {
    $('#tableproject tr td:nth-child(7) a, #dev-link a').click(function(e) {
        //console.log($(this).text());
        //alert($(this).DataTable().row(this).data())
        e.preventDefault();
        var dev_id = $(this).attr('value');
        $.ajax({
            url: "/form/detail/dev/",
            type: "GET",
            data: {
                dev_id: dev_id,

            },
            success: function(result) {
                $(".loginPopup").append(result);
                autocompleteUpdate()
                $('#popupForm').hide()
                $(`#detailForm`).show();
                $(".canceldetail").click(function() {
                    $(`#detailForm`).remove()
                    $('#popupForm').show()
                })
                validFormDev()

                //$('#detailForm input').prop('disabled', true);

            }
        });


    });
}

function date_cover(date) {
    var date = new Date(date)
    date.toDateString
    return date.getFullYear() + '-' + date.getMonth() + '-' + date.getDate()
}

// Remove project
$('#tableproject tr td button:nth-child(2)').click(function(e) {
        $('#delete-modal').show()
        let row = $(this).closest("tr");
        var project_id = row.find(`td:eq(${1})`).text()
        $('#remove-btn').click(function() {
            $.ajax({
                url: '/form/remove/project/',
                type: "POST",
                data: {
                    project_id: project_id,
                    csrfmiddlewaretoken: getCookie('csrftoken'),
                },

                cache: false,
                success: function(dataResult) {
                    if (dataResult.statusCode == 200) {
                        $("#success").show();
                        $('#success').html(dataResult.messages);
                        $('#modelRemove').modal('hide');
                        setTimeout(function() {
                            $("#success").hide();
                        }, 2000);
                        location.reload();
                    } else {
                        $("#error").show();
                        $('#error').html('ERROR!');
                        setTimeout(function() {
                            $("#error").hide();

                        }, 2000);
                    }

                }
            });
        })
        console.log(project_id)


    })
    //Get id dev selected
function devsUpdate(selector = "dev") {
    var devs = ''
    $(`.${selector}sId`).each(function() {
        devs = devs + ',' + String($(this).attr('value'));
        console.log(devs)
    });
    return devs
}

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

//Autocomplete dev in project form
function autocompleteUpdate(selector = "dev") {
    $(`#autocomplete-dev`).autocomplete({
        source: function(request, response) {
            $.ajax({
                url: `/form/devautocomplete/`,
                data: {
                    term: $(`#autocomplete-dev`).val(),
                    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
                },
                dataType: "json",
                type: "GET",
                success: function(data) {
                    response(data);
                }
            });
        },
        select: function(event, ui) {
            id = ui.item.value.split(' - ')[0];
            text = ui.item.value.split(' - ')[1];
            var add = true;
            $(`.devsId`).each(function() {
                var valueA = String($(this).attr('value'));
                if (valueA == String(id)) {
                    add = false
                }
            });
            $(`#autocomplete-dev`).val('');
            if (add == true) {
                html = `<a href='new' class=devsId value='` + id + "'>" + text + "</a>";
                html += "<span class='ti-close'></span>";
                $(`#dev-link`).append(html);

                devDetail()
            }
            $(`#dev-link span`).click(function(e) {
                e.preventDefault();
                $(this).prev().remove();
                $(this).remove();
            });
        }
    })
    $(`#dev-link span`).click(function(e) {
        e.preventDefault();
        $(this).prev().remove();
        $(this).remove();
    });
}